{% extends "GistTemplateBundle::base.html.twig" %}
{% import "GistTemplateBundle::form.html.twig" as form %}

{% set readonly = not app.user.hasAccess('cat_user_user.edit') %}

{% block content %}
    <form method="post" class="form-horizontal">
    {#BEGIN TABS#}
    <!-- start of profile -->
    <div class="row profile">
        <div class="col-md-12">
            <!--BEGIN TABS-->
            <div class="tabbable tabbable-custom tabbable-full-width">
                <!-- MAIN TABS -->
                <ul class="nav nav-tabs">
                    <li class="active">
                        <a href="#tab_pos" data-toggle="tab">
                            POS </a>
                    </li>
                    <li>
                        <a href="#tab_permits" data-toggle="tab">
                            Permits </a>
                    </li>
                    <li>
                        <a href="#tab_rental" data-toggle="tab">
                            Rental </a>
                    </li>
                    <li>
                        <a href="#tab_terminals" data-toggle="tab">
                            Terminals </a>
                    </li>
                    <li>
                        <a href="#tab_insurance" data-toggle="tab">
                            Insurance </a>
                    </li>
                </ul>
                <!-- END MAIN TABS -->
                <div class="tab-content">
                    <!-- POS TAB -->
                    <div class="tab-pane active" id="tab_pos">
                        {% include 'GistLocationBundle:POSLocations:pos.html.twig' %}
                    </div>
                    <div class="tab-pane" id="tab_permits">
                        {% include 'GistLocationBundle:POSLocations:permits.html.twig' %}
                    </div>
                    <div class="tab-pane" id="tab_rental">
                        {% include 'GistLocationBundle:POSLocations:rental.html.twig' %}
                    </div>
                    <div class="tab-pane" id="tab_terminals">
                        {% include 'GistLocationBundle:POSLocations:terminals.html.twig' %}
                    </div>
                    <div class="tab-pane" id="tab_insurance">
                        {% include 'GistLocationBundle:POSLocations:insurance.html.twig' %}
                    </div>
                    
                </div>
            </div>
            <!--END TABS-->
        </div>
    </div>
    <div id="ledger_entries_form" class="modal fade" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <form method="post" action="">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
                        <h4 id="form_title" class="modal-title">Ledger Entries</h4>
                    </div>
                    <div class="modal-body">
                        <div class="row form-horizontalx form">
                            <div class="form-body">
                                <table class="table table-striped table-bordered table-hover" style="margin-top: 20px;" id="list_table">
                                    <thead>
                                        <tr>
                                            <th width="60%">Security Deposit Amount</th>
                                            <th width="40%">Date Created</th>
                                            <th width="10%"></th>
                                        </tr>
                                    </thead>
                                    <tbody id="entries_table">
                                        {#{% for rate in rates %}
                                          <tr>
                                            <td><input type="text" name="rate_name[]" value="{{rate.getRateName|default('')}}" class="form-control rate_name"></td>
                                            <td><input type="number" name="rate_value[]" class="form-control qty" value="{{rate.getRateValue}}" min="1"></td>
                                            <td><a href="javascript:void(0)" class="btn btn-xs default red remove_row">X</a></td>
                                          </tr>
                                        {% endfor %}
                                            <tr>
                                                <td><input type="text" name="amount[]" value="{{rate.getRateName|default('')}}" class="form-control rate_name"></td>
                                                <td><input type="text" name="date[]" class="form-control qty" value="2017-06-23" readonly="true"></td>
                                                <td><a href="javascript:void(0)" class="btn btn-xs default red remove_row"><i class="fa fa-remove"></i></a></td>
                                            </tr>#}
                                    </tbody>
                                </table>
                                <input type="number" id="amount_field" name="amount_field" min="1">
                                <a href="javascript:void(0)" class="btn default green add-ig-field" style="margin=0">Add</a>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" data-dismiss="modal" class="btn default">Close</button>
                        <button id="btn_entry" type="button" class="btn green">Save</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    </form>
    {#END TABS#}
{% endblock %}
{% block js %}
<!-- HERE -->
<script>
function appendItemsField(amount, date)
{ 
    var field = '<tr>';     
        field += '<td><input type="text" name="amount[]" class="form-control amount" value="'+amount+'" readonly="true"></td>';
        field += '<td><input type="text" name="date[]" class="form-control date" value="'+date+'" readonly="true"></td>';     
        field += '<td><a href="javascript:void(0)" class="btn btn-xs default red remove_row">Remove</a></td>'; 
        field += '</tr>';

        $('#entries_table').append(field);
}
$(document).ready(function() {

    var add_button = $(".add-ig-field");
    $(add_button).on('click',function(){      
        var amount = $('#amount_field').val();
        var date = '2017-06-23';

        if (!amount == '') 
        {
            appendItemsField(amount, date);
            $('#amount_field').val('0');
        }
        else
        {
            toastr['error']('Input an amount.', 'Error');
        }
    });   

    var selectedValues = $("#sourceValues").val().split(',');
    $(".select_2-multi").val(selectedValues).trigger("change");

    FormValidation.init(); 

    $(document).on("click",".remove_row", function(e){
            e.preventDefault();            
            var tr = $(this).closest('tr');
            tr.remove();
            return false;
        });

    // set default error and success elements
    jQuery.validator.setDefaults({
        errorClass: 'help-block',
        errorElement: 'span',
        errorPlacement: function(error, element) {
            $("#help").html('');
            if(element.parent().parent().hasClass('form-group'))
            {
                error.appendTo(element.parent().last());
                element.parent().parent().addClass('has-error');
            }
            else if(element.parent().parent().hasClass('checker'))
            {   
                error.appendTo(element.parent().parent().parent().parent().last());
                element.parent().parent().parent().parent().parent().addClass('has-error');
            }
            else
            {
                error.appendTo(element.parent().parent().last());
                element.parent().parent().parent().addClass('has-error');
            }
        },
        success: function(element) {
            $("#help").html('');
            if(element.parent().parent().hasClass('form-group'))
            {  
                element.parent().parent().removeClass('has-error');
                element.parent().parent().addClass('has-success');
            }
            else if(element.parent().parent().hasClass('checker'))
            {   
                element.parent().parent().parent().parent().parent().addClass('has-error');
                element.parent().parent().parent().parent().parent().addClass('has-success');
            }
            else
            {  
                element.parent().parent().parent().removeClass('has-error');
                element.parent().parent().parent().addClass('has-success');
            }

            element.remove();
        }
    });


    // validate form elements
            $(".form-horizontal").validate({
                ignore: "#list_table, #entries_table, .amount .date .modal-body",
                onfocusout: function(element) {
                    this.element(element);
                },
                rules: {
                    name: {
                        required: true
                    },
                    leasor: {
                        required: true
                    },
                    contact_number: {
                        required: true
                    },
                    type: {
                        required: true
                    },
                    brand: {
                        required: true
                    },
                    area: {
                        required: true
                    },
                    status: {
                        required: true
                    },
                    city: {
                        required: true
                    }
                },
                submitHandler: function(form) {
                    form.submit();
                }
            });

});
</script>
{% endblock %}
















